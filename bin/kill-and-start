#!/bin/bash

# Simple script to kill existing processes and start fresh

echo "🔄 Killing existing processes..."

# Kill all Node.js processes related to this project
pkill -f "npm run dev" 2>/dev/null || true
pkill -f "nodemon.*index.js" 2>/dev/null || true
pkill -f "concurrently.*npm run" 2>/dev/null || true
pkill -f "react-scripts start" 2>/dev/null || true

# Kill processes on ports 3000 and 5000 (but be careful with system processes)
echo "🔍 Checking ports 3000 and 5000..."

# Only kill Node.js processes on these ports, not system processes
for port in 3000 5000; do
    PID=$(lsof -ti :$port 2>/dev/null | head -1)
    if [ -n "$PID" ]; then
        # Check if it's a Node.js process
        if ps -p $PID -o comm= | grep -q node; then
            echo "Killing Node.js process $PID on port $port"
            kill -9 $PID 2>/dev/null || true
        else
            echo "Port $port is in use by a system process (PID $PID), skipping..."
        fi
    fi
done

echo "✅ Cleanup complete"
echo "🚀 Starting development servers..."

# Start the development servers
npm run dev
